description: >
  Collects the SHIPYARD_ENVIRONMENT_URL and SHIPYARD_BYPASS_TOKEN for an environment

parameters:
  api-token:
    type: env_var_name
    default: "SHIPYARD_API_TOKEN"
    description: "Shipyard API token used to fetch necessary environment variables from Shipyard."
  timeout-minutes:
    type: integer
    default: 60
    description: "# of minutes to wait for Shipyard environment before timing out"

steps:
  - jq/install
  - run:
      name: "Gracefully exit if this is not a PR branch"
      command: "[[ -z $CIRCLE_PULL_REQUEST ]] && circleci-agent task halt || echo This job is for: $CIRCLE_PULL_REQUEST"
  - run:
      name: "Fetch the Shipyard environment variables"
      environment:
          SHIPYARD_TIMEOUT: <<parameters.timeout-minutes>>
      command: <<include(scripts/orb.sh)>>
